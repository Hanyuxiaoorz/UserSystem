<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mis.user.backstagemanagement.dao.UserShowMapper">
    <resultMap id="BaseResultMap" type="com.mis.user.backstagemanagement.model.UserShowInfo">
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="userName" property="userName" jdbcType="VARCHAR" />
        <result column="password" property="password" jdbcType="VARCHAR" />
        <result column="e_mail" property="e_mail" jdbcType="VARCHAR" />
        <result column="sex" property="sex" />
        <result column="phone_number" property="phone_number" />
        <result column="major" property="major" />
        <result column="class_number" property="class_number" />
        <result column="study_direction" property="study_direction" />
        <result column="age" property="age" />
        <result column="birth" property="birth" />
        <result column="habit" property="habit" />
        <result column="state" property="state" />
    </resultMap>

    <parameterMap id="ParameterMap" type="Map">
        <parameter property="UserName"/>
        <parameter property="state"/>
    </parameterMap>

    <!-- 后台管理 用户信息查询 -->
    <!-- 根据分页数据start 和size查询数据 -->
    <select id="findByPage" resultType="com.mis.user.backstagemanagement.model.PageBean">
        select *
        from user_mess
        <if test="start!=null and size!=null">
            limit #{start},#{size}
        </if>
    </select>

    <!--查询所有用户数据 -->
    <select id="selectUserList" parameterType="com.mis.user.backstagemanagement.model.UserShowInfo" resultMap="BaseResultMap">
        select *
        from user_mess
    </select>

    <!-- 查询用户记录总数 -->
    <select id="userAmount" resultType="int">
        select count(*) from user_mess
    </select>

    <!-- 查找管理员数量 -->
    <select id="managerAmount" resultType="int">
        SELECT count(state)
        FROM user_mess
        WHERE state > 0
    </select>

    <!-- 查询学习方向 -->
    <select id="androidNum" resultType="int">
        SELECT count(study_direction)
        FROM user_mess
        WHERE study_direction = "安卓"
    </select>

    <select id="bgNum" resultType="int">
        SELECT count(study_direction)
        FROM user_mess
        WHERE study_direction = "后台"
    </select>

    <select id="frontNum" resultType="int">
        SELECT count(study_direction)
        FROM user_mess
        WHERE study_direction = "前端"
    </select>

    <select id="PyNum" resultType="int">
        SELECT count(study_direction)
        FROM user_mess
        WHERE study_direction = "Python"
    </select>

    <select id="algNum" resultType="int">
        SELECT count(study_direction)
        FROM user_mess
        WHERE study_direction = "算法"
    </select>

    <!-- 通过主键来查询用户详细资料 -->
    <select id="selectByUserName" parameterType="com.mis.user.backstagemanagement.model.UserShowInfo" resultMap="BaseResultMap">
        SELECT *
        FROM user_mess
        WHERE userName = #{userName,jdbcType=VARCHAR}
    </select>
    <select id="selectByUserId" parameterType="com.mis.user.backstagemanagement.model.UserShowInfo" resultMap="BaseResultMap">
        SELECT *
        FROM user_mess
        WHERE id = #{id,jdbcType=VARCHAR}
    </select>
    <select id="selectByUserEmail" parameterType="com.mis.user.backstagemanagement.model.UserShowInfo" resultMap="BaseResultMap">
        SELECT *
        FROM user_mess
        WHERE e_mail = #{e_mail,jdbcType=VARCHAR}
    </select>

    <!-- 通过用户名更改用户密码 -->
    <update id="changePasswordByUserName" parameterType="java.lang.String">
        UPDATE
        user_mess
        SET password="111111"
        WHERE
        userName = #{userName,jdbcType=VARCHAR}
    </update>
    <!-- 查找该用户密码，判断是否修改成功 -->
    <select id="selectPassword" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT password
        FROM user_mess
        WHERE userName = #{userName,jdbcType=VARCHAR}
    </select>
    <!-- 查询该用户权限值 -->
    <select id="selectStateByUserName" parameterType="java.lang.String" resultType="int">
        SELECT state
        FROM user_mess
        WHERE userName = #{userName,jdbcType=VARCHAR}
    </select>

    <select id="selectStateById" parameterType="java.lang.String" resultType="int">
        SELECT state
        FROM user_mess
        WHERE id = #{id,jdbcType=VARCHAR}
    </select>

    <select id="selectStateByE_mail" parameterType="java.lang.String" resultType="int">
        SELECT state
        FROM user_mess
        WHERE e_mail = #{e_mail,jdbcType=VARCHAR}
    </select>
    <!-- 更改密码完成 -->

    <!-- 更改用户等级 -->
    <update id="updateStateByUserName" parameterMap="ParameterMap">
        UPDATE
        user_mess
        SET state = #{state}
        WHERE userName = #{userName,jdbcType=VARCHAR}
    </update>

    <!--用户的删除-->
    <delete id="deleteUserByUserName" parameterType="java.lang.String" >
        DELETE
        FROM user_mess
        WHERE userName = #{userName}
    </delete>
    <!-- 后台管理结束 -->
</mapper>